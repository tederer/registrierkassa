<!doctype html>
<html>
<head>
   <title>online Kassa</title>
   <link rel="stylesheet" type="text/css" href="css/jquery.dataTables-1.10.12.css">
   <link rel="stylesheet" type="text/css" href="css/select.dataTables-1.2.0.min.css">
   <link rel="stylesheet" type="text/css" href="css/cash.css">
   <link rel="stylesheet" type="text/css" href="css/cash.ui.itemSelectionDialog.css">
   <link rel="stylesheet" type="text/css" href="css/cash.ui.editInvoiceItemDialog.css">
   <link rel="stylesheet" type="text/css" href="css/cash.ui.editProductsDialog.css">
   <link rel="stylesheet" type="text/css" href="css/cash.ui.createProductDialog.css">

   <script type="text/javascript" src="javascripts/RequireMock.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/NamespaceUtils.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/SharedTopics.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/ClientTopics.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/common/infrastructure/bus/Bus.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/common/infrastructure/busbridge/BusBridge.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/common/infrastructure/busbridge/MessageFactory.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/common/infrastructure/busbridge/ClientSocketIoBusBridge.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/common/infrastructure/busbridge/connection/ClientSocketIoConnection.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/Tabs.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/UiComponent.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/ModalDialog.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/ItemSelectionDialog.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/EditInvoiceItemDialog.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/EditProductsDialog.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/CreateProductDialog.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/InvoiceTable.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/client/TotalPanel.js" charset="UTF-8"></script>
   <script type="text/javascript" src="lib/jquery-3.1.0.js" charset="UTF-8"></script>
   <script type="text/javascript" src="lib/jquery.dataTables-1.10.12.min.js" charset="UTF-8"></script>
   <script type="text/javascript" src="lib/dataTables.select-1.2.0.min.js" charset="UTF-8"></script>
   <script src="/socket.io/socket.io.js" charset="UTF-8"></script>
   <script>
      var bus = new common.infrastructure.bus.Bus();
      var itemSelectionDialog = new cash.ui.ItemSelectionDialog('#cash > #itemSelectionDialog', bus);
      var editInvoiceItemDialog = new cash.ui.EditInvoiceItemDialog('#cash > #editInvoiceItemDialog', bus);
      var editProductsDialog = new cash.ui.EditProductsDialog('#cash > #editProductsDialog', bus);
      var createProductDialog = new cash.ui.CreateProductDialog('#cash > #newProductDialog', bus);
      var invoiceTable = new cash.ui.InvoiceTable('#cash > #content > #invoice > #items', bus);
      var totalPanel = new cash.ui.TotalPanel('#cash > #content > #invoice > #total', bus);
      
      var simulateServerStartup = function simulateServerStartup() {
         var data = [{id:1, name: 'in vitro Kultur', price: 10},
                     {id:2, name: 'Orchidee blühstark', price: 15},
                     {id:3, name: 'Substrat', price: 5.5},
                     {id:4, name: 'Dünger', price: 4.5},
                     {id:5, name: 'Kunststofftopf 12cm', price: 1.5}];
                     
         bus.publish(cash.topics.PRODUCTS, data);
         bus.subscribeToCommand(cash.topics.DELETE_PRODUCT_COMMAND, function(commandData) {
            console.log(cash.topics.DELETE_PRODUCT_COMMAND + ' = ' + JSON.stringify(commandData));
         });
         bus.subscribeToCommand(cash.topics.CREATE_PRODUCT_COMMAND, function(commandData) {
            console.log(cash.topics.CREATE_PRODUCT_COMMAND + ' = ' + JSON.stringify(commandData));
         });
      };
      
      simulateServerStartup();
      
      $(document).ready(function() {
         $('#cash > #tabs > #invoice').on('click', showTab.bind(this, 'invoice'));
         $('#cash > #tabs > #administration').on('click', showTab.bind(this, 'administration'));
         
         itemSelectionDialog.initialize();
         editInvoiceItemDialog.initialize();
         editProductsDialog.initialize();
         createProductDialog.initialize();
         invoiceTable.initialize();
         totalPanel.initialize();
         
         $('#cash > #content > #invoice > #sidebar > #addItemButton').on('click', function() {itemSelectionDialog.show();});
         $('#cash > #content > #administration > #editProductsButton').on('click', function() {editProductsDialog.setVisible(true);});
      });
   </script>
</head>

<body>
<div id="cash">
   <div id="itemSelectionDialog"></div>
   <div id="editInvoiceItemDialog"></div>
   <div id="editProductsDialog"></div>
   <div id="newProductDialog"></div>

   <div id="tabs">
      <div id="invoice"/>Rechnung</div>
      <div id="administration"/>Administration</div>
   </div>

   <div id="content">
      <div id="invoice">
         <div id="items"></div>
         <div id="total"></div>
         <div id="sidebar">
             <button type="button" id="addItemButton">Produkt hinzufügen</button> 
         </div>
      </div>
      <div id="administration">
         <button type="button" id="editProductsButton">Produkte bearbeiten</button> 
      </div>
   </div>
   
   <div id="footer">
      <div id="author">written by Thomas Ederer</div>
   </div>
</div>
</body>
</html>  