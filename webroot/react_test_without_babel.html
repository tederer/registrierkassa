<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<script type="text/javascript" src="javascripts/RequireMock.js"></script>
<script type="text/javascript" src="javascripts/NamespaceUtils.js"></script>
<script type="text/javascript" src="javascripts/common/infrastructure/bus/Bus.js"></script>
<script type="text/javascript" src="javascripts/common/infrastructure/busbridge/BusBridge.js"></script>
<script type="text/javascript" src="javascripts/common/infrastructure/busbridge/ClientSocketIoBusBridge.js"></script>
<script type="text/javascript" src="javascripts/common/infrastructure/busbridge/connection/ClientSocketIoConnection.js"></script>
<script type="text/javascript" src="lib/jquery-3.1.0.js"></script>
<script src="lib/react-15.3.0.min.js"></script>
<script src="lib/react-dom-15.3.0.min.js"></script>
</head>

<body>
Client test
<div id="content"></div>

<script>
var counter = 0;
var topic = '/connection/state';
var bus = new common.infrastructure.bus.Bus();

var pElement = React.createElement(
    'p',
    null,
    'ConnectionState: ', 'bla', '123'
  );
  
var ConnectionState = React.createClass({
   componentDidMount: function() {
      var thisInstance = this;
      
      bus.subscribeToPublication(topic, function(data) {
         console.log('received: ' + data);
         thisInstance.setState({connectionState: data});
      });
   },
   
   clickHandler: function clickHandler(event) {
      console.log('clickHandler: ' + event);
   },
   
   getInitialState: function() {
       return {connectionState: 'n.a.'};
   },
   
   render: function() {
      return React.createElement('p', {onClick: this.clickHandler}, 'ConnectionState: ', this.state.connectionState);
   }
});

var content = React.createElement(ConnectionState, [], []);

ReactDOM.render(content, document.getElementById('content'));

setInterval(function() {bus.publish(topic, counter++);}, 1000);
</script>
</body>
</html>